{"version":3,"file":"[...path].ts","sources":["D:\\Projects\\SIAI Lovable\\api\\admin\\[...path].ts"],"names":[],"mappings":"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","sourcesContent":["function deriveFunctionsBaseUrl() {\n  const supabaseUrl = process.env.SUPABASE_URL ?? process.env.VITE_SUPABASE_URL ?? \"\";\n  if (!supabaseUrl) return null;\n  const ref = new URL(supabaseUrl).hostname.split(\".\")[0];\n  if (!ref) return null;\n  return `https://${ref}.functions.supabase.co`;\n}\n\nasync function readBody(req: AsyncIterable<unknown>) {\n  const chunks: Buffer[] = [];\n  for await (const chunk of req) {\n    if (Buffer.isBuffer(chunk)) chunks.push(chunk);\n    else if (typeof chunk === \"string\") chunks.push(Buffer.from(chunk));\n    else if (chunk instanceof Uint8Array) chunks.push(Buffer.from(chunk));\n  }\n  return Buffer.concat(chunks);\n}\n\nexport default async function handler(req: any, res: any) {\n  const functionsBase = deriveFunctionsBaseUrl();\n  if (!functionsBase) {\n    res.status(500).json({ error: \"configuration_error\" });\n    return;\n  }\n\n  const incoming = new URL(String(req.url ?? \"/\"), \"http://localhost\");\n  const path = incoming.pathname.replace(/^\\/api\\/admin/, \"\");\n  const targetUrl = `${functionsBase}/api-admin${path}${incoming.search}`;\n\n  const headers = new Headers();\n  for (const [k, v] of Object.entries(req.headers)) {\n    if (!v) continue;\n    if (k.toLowerCase() === \"host\") continue;\n    if (k.toLowerCase() === \"connection\") continue;\n    if (k.toLowerCase() === \"content-length\") continue;\n    if (Array.isArray(v)) headers.set(k, v.join(\",\"));\n    else headers.set(k, String(v));\n  }\n\n  const method = (req.method ?? \"GET\").toUpperCase();\n  const body = method === \"GET\" || method === \"HEAD\" ? undefined : await readBody(req);\n\n  const upstream = await fetch(targetUrl, { method, headers, body, redirect: \"manual\" });\n\n  const setCookies = (upstream.headers as unknown as { getSetCookie?: () => string[] }).getSetCookie?.() ?? [];\n  for (const [k, v] of upstream.headers.entries()) {\n    const key = k.toLowerCase();\n    if (key === \"set-cookie\") continue;\n    res.setHeader(k, v);\n  }\n  if (setCookies.length) res.setHeader(\"set-cookie\", setCookies);\n\n  res.status(upstream.status);\n  const buf = Buffer.from(await upstream.arrayBuffer());\n  res.send(buf);\n}\n"]}